{% extends 'base.html' %}
{% block head %}
<title>Dashboard</title>
{% endblock %}

{% block content %}
<div class="content">
    <h1>Task Smash</h1>

    <!-- TASKS TABLE -->
    {% if tasks|length < 1 %}
        <h2>No tasks yet. Add one below!</h2>
    {% else %}
    <table>
        <tr>
            <th>Task</th>
            <th>Updated</th>
            <th>Actions</th>
        </tr>
        {% for task in tasks %}
        <tr onclick='window.location="/edit/{{task.id}}"' >
            <td>{{ task.content }}</td>
            <td>{{ task.updated.strftime("%H-%M-%S") }}</td>
            <td>
                <a href="/delete/{{task.id}}" id="delete">Delete</a>
                <br/>
                <a href="/edit/{{task.id}}" id="edit">Edit</a>
            </td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <form action="/" method="POST">
        <input type="hidden" name="form_type" value="task">
        <input type="text" name="content" placeholder="Add Task" required/>
        <input type="submit" value="Add Task"/>
    </form>

    <hr>

    <!-- SPENDING CHART -->
    <h1>Spending</h1>

    <form method="POST" action="{{ url_for('add_spending') }}">
        <input type="hidden" name="form_type" value="spending">
        <input type="text" name="category" placeholder="Category" required>
        <input type="number" step="0.01" name="amount" placeholder="Amount" required>
        <button type="submit">Add Spending</button>
    </form>

    <canvas id="spendingChart" width="400" height="200"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    const ctx = document.getElementById('spendingChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ categories|tojson }},
            datasets: [{
                label: 'Spending by Category',
                data: {{ amounts|tojson }},
                backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
        },
        options: { responsive: true }
    });
    </script>
</div>
{% endblock %}
